SELECT ESB001_ALMOXARIFADO ALMOX, 
        DECODE(ESB001_PRODUTOCONF, 0, ESB001_PRODUTO, ESB001_PRODUTO||'-'||ESB001_PRODUTOCONF) PRODUTO, 
        TO_CHAR(ESB001_DATALCTO, 'DD/MM/RRRR') DATALANC, 
        DECODE(ESB001_TIPOMOV, 'E', 'ENTRADA', 'S', 'SAÍDA') TIPOMOV, 
        ESB001_UMEST UN, 
        SUM(ESB001_QUANTIDADE) QTD 
 
FROM ESTBB001 
 
WHERE ESB001_ALMOXARIFADO = 16 
  AND ESB001_TIPOMOV = 'E' 
  AND TO_CHAR(ESB001_DATALCTO, 'DD/MM/RRRR') = TO_CHAR(SYSDATE, 'DD/MM/RRRR') 
 
GROUP BY ESB001_ALMOXARIFADO, 
        ESB001_PRODUTO, 
        ESB001_PRODUTOCONF, 
        TO_CHAR(ESB001_DATALCTO, 'DD/MM/RRRR'), 
        ESB001_TIPOMOV, 
        ESB001_UMEST, 
 
        TO_CHAR(ESB001_DATALCTO, 'RRRR'), 
        TO_CHAR(ESB001_DATALCTO, 'MM'), 
        TO_CHAR(ESB001_DATALCTO, 'DD') 
 
ORDER BY TO_CHAR(ESB001_DATALCTO, 'RRRR') DESC, 
        TO_CHAR(ESB001_DATALCTO, 'MM') DESC, 
        TO_CHAR(ESB001_DATALCTO, 'DD') DESC 