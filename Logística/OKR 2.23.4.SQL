/*NÃO TRASNFERIDA*/

SELECT *

FROM RMTBC001

WHERE RMC001_AXORIGEM IN (1,13,43)
  --AND RMC001_AXDESTINO = 17
  AND RMC001_TIPODOCOP = 'OP' /*DEIXAR COMO FILTRO PARA FILTRAR TODOS OS TIPOS DE OP*/
  --AND RMC001_ORDEM IN (312866,313159,313082,313074,313003,312072,313125,312999,313122,313129,313126,313123,312998,313129,312640,312584,313132,310796,313159,313079,312950,313121,313076,312031,313124,312933,312738,313010,313128,313131,313130,312844,312940,312634,312955,312973,312942,312943,312988,312592,312772,312909,311925,312870,312657,311353,312487,312876,312862,312731,312832,312934,312958,312990,312944,312410,312411,312984,312771,312961,313016,312993,312939,312941,312879,312880,312890,312908,312935,312864,312770,312947,312701,312773,312873,312938,312850,312937,312332,312853,312852,312847,312765,312851,312725,311407,312855,312739,312734,312848,312032,311785,311202,312829,312843,312671,312826,311406,312414,311577,312599,312145,312762,312745,312677,312680,312763,312743,312482,312626,312727,312728,312760,312746,312034,311140,312767,312074,312189,311937,312769,312766,31256,312759,311636,312722,312351,312350,312417,309948,312649,312591,312685,312670,312585,312625,312149,312500,312660,312663,312479,312644,312669,312672,312641,312028,312687,312154,311807,312673,312122,312590,312484,312219,312668,310443,312469,312658,312688,312686,312463,312670,312670)
  --AND RMTBC001.DATE_CREATED BETWEEN :DATAINI AND :DATAFIM
  
  --QUDTRANSFERIDA COMO ATENDIDO OU QTD DE ITENS ATENDIDOS CONFORME SOLICITADO
  
  /*usar OPTBS012 que é o item para verificara ordem e o dia programado junto ao recurso*/
  
  AND RMC001_CODSITUACAO = :CODSIT /*()*/
  AND RMC001_SITUACAO = :SIT /*1 É ABERTO 2 É FECHADO OU 3 AMBOS USAR COMO FILTRO*/
  
  /*USAR COMO BASE FALTA MATERIAL PRODUÇÃO ALMOX 14*/
  
-- 200598 -> SIT 1 E 1 TOTALMENTE EM ABERTO
-- 215583 -> SIT 1 E 2 
-- 303384 -> SIT 2 E 1 = 833 REGISTROS
-- 247730 -> 4 E 1 = EM ABERTO, MAS FOI CANCELADO
-- 288845 -> 6 E 1 = 6 REGISTROS
-- 212478 -> 2 E 2 = 40 REGISTROS (ABERTO E PARCIALMENTE ATENDIDO)
-- 200750 -> 3 E 2 FECHADO - ATENDIDO TOTALMENTE
-- 200005 -> 5 E 2 TOTALMENTE CANCELADO
-- 236111 -> 6 E 2 = 1 FECHADO PARCIALMENTE ATENDIDO COM CANCELAMENTO 
-- 6 E 1 -> ABERTO - PARCIALMENTE ATENDIDO COM CANCELAMENTO
-- 178 OU 295524 -> 7 E 2  FECHADO COM CANCELAMENTO


/*TRAZER TODAS AS SITUAÇÕES INDEPENDENTE PARA QUE A DATA POSSA ANULAR*/
/*DIVIDIR POR RECURSO DE ACORDO COM OS SETORES E ALMOXARIFADO DE DESTINO*/
/*O ALMOXARIFADO DE ORIGEM DEVE SE MANTER NO 1,13,43*/
/*FILTROS DATA, FILTRO DE OP OU SEJA TIPODOC, FILTRO DE ORDEM*/

;

/*USAR COMO BASE DE CONSULTA*/

SELECT RMC001_TIPODOCOP||' - '||RMC001_ORDEM AS ORDEM,
       MAX(OPS012_PRODUTO||' - '||ESA001_DESCSINT) AS PRODUTO,
       MAX(RMC001_AXORIGEM) AS ALMOX,
       MAX(ESFBI001(RMC001_GRUPO, RMC001_EMPRESA, RMC001_FILIAL, RMC001_PRODUTO, RMC001_PRODUTOCONF)) AS LOCAL,
       MAX(MPB001_RECURSO ||'-'|| MPB001_DESCRICAO) AS LINHA,
       OPS012_DATASIMUL AS DATA,
       COUNT(RMC001_ORDEM) AS REGISTROS

  FROM RMTBC001

  JOIN OPTBS012
    ON OPS012_GRUPO = RMC001_GRUPO
   AND OPS012_EMPRESA = RMC001_EMPRESA
   AND OPS012_FILIAL = RMC001_FILIAL
   AND OPS012_TIPODOC = RMC001_TIPODOCOP
   AND OPS012_ORDEM = RMC001_ORDEM
   AND OPS012_LINHA = RMC001_LINHAOP

  JOIN OPTBS011
    ON OPS011_ID = OPS012_OPS011_ID

  JOIN MPTBB001
    ON MPB001_GRUPO = OPS012_GRUPO
   AND MPB001_EMPRESA = OPS012_EMPRESA
   AND MPB001_RECURSO = OPS012_RECURSO

  JOIN ESTBA001
    ON ESA001_GRUPO = OPS012_GRUPO
   AND ESA001_EMPRESA = OPS012_EMPRESA
   AND ESA001_PRODUTO = OPS012_PRODUTO

 WHERE OPS011_STATUS = 2
   AND RMC001_TIPODOCOP = 'OP'
   AND RMC001_AXORIGEM :ALMOX
   AND OPS012_DATASIMUL BETWEEN :DATAINI AND :DATAFIM
   

GROUP BY RMC001_TIPODOCOP||' - '||RMC001_ORDEM, OPS012_DATASIMUL

ORDER BY OPS012_DATASIMUL ASC
