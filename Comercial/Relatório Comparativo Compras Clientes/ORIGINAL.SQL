SELECT PPA001_PESSOA, 
        PPA001_NOME, 
        TAA075_DESCRICAO, 
        SUM(NSA001_TOTALNOTA) TOTAL, 
        ROUND(100*RATIO_TO_REPORT(SUM(NSA001_TOTALNOTA)) OVER (),3) REPR, 
       (RANK() OVER(ORDER BY SUM(NSA001_TOTALNOTA) DESC)||'Â°') RANK 
 
FROM NSTBA001, PPTBA001, PPTBA004, TATBA054, TATBA073, TATBA075, TATBA076 
 
WHERE NSA001_CLIENTE = PPA001_PESSOA 
  AND PPA004_PESSOA = PPA001_PESSOA 
  AND TAA075_SEGMENTO = PPA004_SEGMENTO 
  AND TAA073_AREA = PPA004_AREA 
  AND TAA054_GRUPOPESSOA = PPA004_GRUPOPESSOA 
  AND TAA076_SUBGRUPO = PPA004_SUBGRUPO 
  AND PPA004_SEGMENTO IN (:SEG1, :SEG2, :SEG3) 
  AND NSA001_DATASAIDA BETWEEN :DATAINI AND :DATAFIN 
 
GROUP BY PPA001_PESSOA, 
          PPA001_NOME, 
          TAA075_DESCRICAO, 
          PPA004_SEGMENTO, 
          TAA075_DESCRICAO 
 
ORDER BY SUM(NSA001_TOTALNOTA) DESC 